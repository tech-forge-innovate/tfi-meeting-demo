<ng-container *ngIf="!showInput; else notLoggedIn">
    <div class="p-4 flex gap-8">
        <div class="h-full">
            <h3 class="text-2xl font-semibold py-4">Chat Sample</h3>
            <p-card styleClass="rounded shadow-2 border w-[400px] h-[500px]">
                <div class="flex flex-col">
                    <!-- Chat Header -->
                    <div class="p-3 border-bottom-1 border rounded font-bold text-900 bg-gray-100 dark:bg-gray-700">
                        Room Chat
                    </div>

                    <!-- Chat Message List -->
                    <p-scrollPanel [style]="{ height: '300px' }" class="py-3" styleClass="flex-1">
                        <div *ngFor="let message of messages" class="mb-3 ">
                            <div
                                    [ngClass]="{
              'text-right': message.participantId === participantId,
              'text-left': message.participantId !== participantId
        }"
                            >
                                <div
                                        [ngClass]="{
            'bg-primary text-white': message.participantId === participantId,
            'bg-gray-200 dark:bg-gray-700 text-900': message.participantId !== participantId
          }"
                                        class="inline-block px-3 py-2 rounded-xl text-sm"
                                >
                                    <div class="mb-1 font-semibold text-xs text-600">
                                        {{ message.senderName || 'User' }}
                                    </div>
                                    <div>{{ message.message }}</div>
                                </div>
                            </div>
                        </div>
                    </p-scrollPanel>

                    <!-- Chat Input -->
                    <form (ngSubmit)="sendMessage()" class="flex gap-2 p-3 border-top-1 border-1">
                        <input
                                [(ngModel)]="inputMessage"
                                class="flex-1"
                                name="message"
                                pInputText
                                placeholder="Type your message..."
                                type="text"
                        />
                        <p-button type="submit" aria-label="Save" icon="pi pi-send"/>
                    </form>
                </div>
            </p-card>
        </div>
        <div class="h-full">
            <h3 class="text-2xl font-semibold py-4">Poll</h3>
            <p-card *ngIf="poll; else noPoll" class="block rounded-xl border shadow-2 w-[400px] h-full">
                <ng-template #header>
                    <h3 class="text-xl p-4">{{ poll.question }}</h3>
                </ng-template>

                <div class="flex flex-column gap-3">
                    <ng-container *ngIf="!voted">
                        <button
                                (click)="vote(option)"
                                *ngFor="let option of poll.options"
                                [label]="option.value"
                                class="p-button-outlined p-button-secondary text-left justify-content-start"
                                pButton
                                style="width: 100%"
                        ></button>
                    </ng-container>

                    <ng-container *ngIf="voted">
<!--                        <ng-container *ngIf="waitingForResult">-->
<!--                            <div class="text-center text-primary font-semibold py-4">-->
<!--                                Please wait for poll results...-->
<!--                            </div>-->
<!--                        </ng-container>-->
                        <ng-container *ngIf="pollResult">
                            <p-chart  [data]="basicData" [options]="basicOptions" type="bar"></p-chart>
                        </ng-container>
                    </ng-container>
                </div>

                <ng-template #footer>
                    <div *ngIf="!voted" class="text-center text-500 text-sm">
                        Select an option to vote
                    </div>
<!--                    <div *ngIf="voted && waitingForResult" class="text-center text-primary font-semibold">-->
<!--                        Waiting for poll results...-->
<!--                    </div>-->
                    <div *ngIf="voted && pollResult"
                         class="text-center text-success font-semibold">
                        Thank you for voting!
                    </div>
                </ng-template>
            </p-card>
            <ng-template #noPoll>
                <div class="rounded-xl border shadow-2 w-[400px] h-full flex items-center justify-center text-center p-6 text-500">
                    Wait for the next poll or poll not available.
                </div>
            </ng-template>
        </div>
    </div>
    <p-divider></p-divider>
    <div class="p-4">
        <h3 class="text-xl p-4">Presenter Controls</h3>
        <p-table [tableStyle]="{ 'min-width': '50rem' }" [value]="polls">
            <ng-template #header>
                <tr>
                    <th>Question</th>
                    <th>Action</th>
                    <th>Action</th>
                </tr>
            </ng-template>
            <ng-template #body let-product>
                <tr>
                    <td>{{ product.question }}</td>
                    <td>
                        <p-button (onClick)="publishPoll(product.id)">Publish</p-button>
                    </td>
                    <td>
                        <p-button (onClick)="publishPollResult(product.id)">Publish Result</p-button>
                    </td>
                </tr>
            </ng-template>
        </p-table>

    </div>
</ng-container>


<ng-template #notLoggedIn>
    <div class="p-fluid p-4 surface-card border-round shadow-2 w-full sm:w-30rem mx-auto">
        <form (ngSubmit)="onSubmit()" class="flex flex-col gap-4">
            <div class="field">
                <label class="block text-900 font-medium mb-2" for="name">Name</label>
                <input
                        [(ngModel)]="inputName"
                        class="w-full"
                        id="name"
                        name="name"
                        pInputText
                        required
                        type="text"
                />
            </div>

            <div class="field">
                <label class="block text-900 font-medium" for="email">Email</label>
                <input
                        [(ngModel)]="inputEmail"
                        class="w-full"
                        id="email"
                        name="email"
                        pInputText
                        required
                        type="email"
                />
            </div>

            <div class="flex justify-content-end">
                <button
                        class="p-button-primary"
                        label="Join Meeting"
                        pButton
                        type="submit"
                ></button>
            </div>
        </form>
    </div>
</ng-template>